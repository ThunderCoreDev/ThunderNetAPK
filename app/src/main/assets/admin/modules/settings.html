<div class="settings-module">
    <div class="module-header">
        <h2><i class="fas fa-cog"></i> Configuración del Servidor</h2>
    </div>
    
    <div class="settings-tabs">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab('databaseTab')">
                <i class="fas fa-database"></i> Base de Datos
            </button>
            <button class="tab-button" onclick="openTab('serverTab')">
                <i class="fas fa-server"></i> Servidor
            </button>
            <button class="tab-button" onclick="openTab('servicesTab')">
                <i class="fas fa-network-wired"></i> Servicios
            </button>
            <button class="tab-button" onclick="openTab('securityTab')">
                <i class="fas fa-shield-alt"></i> Seguridad
            </button>
        </div>
        
        <div class="tab-content">
            <!-- Pestaña Base de Datos -->
            <div id="databaseTab" class="tab-pane active">
                <h3><i class="fas fa-database"></i> Configuración de Bases de Datos</h3>
                
                <div class="database-config">
                    <div class="input-group">
                        <label>Dirección IP del Servidor MySQL</label>
                        <input type="text" id="dbHost" value="localhost" placeholder="ej: 127.0.0.1">
                    </div>
                    
                    <div class="input-group">
                        <label>Puerto MySQL</label>
                        <input type="number" id="dbPort" value="3306">
                    </div>
                    
                    <div class="input-group">
                        <label>Usuario MySQL</label>
                        <input type="text" id="dbUser" value="root">
                    </div>
                    
                    <div class="input-group">
                        <label>Contraseña MySQL</label>
                        <input type="password" id="dbPassword" value="">
                    </div>
                    
                    <div class="database-list">
                        <h4>Bases de Datos</h4>
                        
                        <div class="database-item">
                            <div class="db-info">
                                <strong>Base de Datos Auth</strong>
                                <p>Almacena información de cuentas, seguridad y acceso</p>
                            </div>
                            <input type="text" id="dbAuth" value="auth" class="db-input">
                        </div>
                        
                        <div class="database-item">
                            <div class="db-info">
                                <strong>Base de Datos Characters</strong>
                                <p>Almacena personajes, inventarios y progreso</p>
                            </div>
                            <input type="text" id="dbCharacters" value="characters" class="db-input">
                        </div>
                        
                        <div class="database-item">
                            <div class="db-info">
                                <strong>Base de Datos World</strong>
                                <p>Almacena el mundo, items, NPCs y quests</p>
                            </div>
                            <input type="text" id="dbWorld" value="world" class="db-input">
                        </div>
                    </div>
                    
                    <div class="test-connection">
                        <button class="btn btn-primary" onclick="testDatabaseConnection()">
                            <i class="fas fa-plug"></i> Probar Conexión
                        </button>
                        <div id="dbTestResult"></div>
                    </div>
                </div>
            </div>
            
            <!-- Pestaña Servidor -->
            <div id="serverTab" class="tab-pane">
                <h3><i class="fas fa-server"></i> Configuración del Servidor WoW</h3>
                
                <div class="server-config">
                    <div class="input-group">
                        <label>Nombre del Servidor</label>
                        <input type="text" id="serverName" value="ThunderNet WoW">
                    </div>
                    
                    <div class="input-group">
                        <label>Mensaje MOTD</label>
                        <textarea id="serverMotd" rows="3" placeholder="Mensaje del día..."></textarea>
                    </div>
                    
                    <div class="input-group">
                        <label>Máximo de Jugadores</label>
                        <input type="number" id="maxPlayers" value="100">
                    </div>
                    
                    <div class="input-group">
                        <label>Tasa de Experiencia</label>
                        <input type="number" id="xpRate" value="1" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label>Tasa de Dinero</label>
                        <input type="number" id="moneyRate" value="1" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label>Tasa de Drop</label>
                        <input type="number" id="dropRate" value="1" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label>Tasa de Reputación</label>
                        <input type="number" id="repRate" value="1" step="0.1">
                    </div>
                </div>
            </div>
            
            <!-- Pestaña Servicios -->
            <div id="servicesTab" class="tab-pane">
                <h3><i class="fas fa-network-wired"></i> Servicios y Puertos</h3>
                
                <div class="services-config">
                    <div class="service-item">
                        <div class="service-info">
                            <h4>SOAP Service</h4>
                            <p>Servicio para ejecutar comandos remotos</p>
                        </div>
                        <div class="service-config">
                            <label>Puerto:</label>
                            <input type="number" id="soapPort" value="7878">
                            <label>Estado:</label>
                            <span class="status-badge status-online">Activo</span>
                        </div>
                    </div>
                    
                    <div class="service-item">
                        <div class="service-info">
                            <h4>RA (Remote Access)</h4>
                            <p>Acceso remoto a la consola</p>
                        </div>
                        <div class="service-config">
                            <label>Puerto:</label>
                            <input type="number" id="raPort" value="3443">
                            <label>Estado:</label>
                            <span class="status-badge status-offline">Inactivo</span>
                        </div>
                    </div>
                    
                    <div class="service-item">
                        <div class="service-info">
                            <h4>World Server</h4>
                            <p>Servidor principal del mundo</p>
                        </div>
                        <div class="service-config">
                            <label>Puerto:</label>
                            <input type="number" id="worldPort" value="8085">
                            <label>Estado:</label>
                            <span class="status-badge status-online">Activo</span>
                        </div>
                    </div>
                    
                    <div class="service-item">
                        <div class="service-info">
                            <h4>Auth Server</h4>
                            <p>Servidor de autenticación</p>
                        </div>
                        <div class="service-config">
                            <label>Puerto:</label>
                            <input type="number" id="authPort" value="3724">
                            <label>Estado:</label>
                            <span class="status-badge status-online">Activo</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pestaña Seguridad -->
            <div id="securityTab" class="tab-pane">
                <h3><i class="fas fa-shield-alt"></i> Configuración de Seguridad</h3>
                
                <div class="security-config">
                    <div class="input-group">
                        <label>IPs Permitidas</label>
                        <textarea id="allowedIPs" rows="4" placeholder="Una IP por línea..."></textarea>
                    </div>
                    
                    <div class="input-group">
                        <label>Máximos Intentos de Login</label>
                        <input type="number" id="maxLoginAttempts" value="3">
                    </div>
                    
                    <div class="input-group">
                        <label>Tiempo de Bloqueo (minutos)</label>
                        <input type="number" id="lockoutTime" value="15">
                    </div>
                    
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="enableSSL" checked>
                            <span>Habilitar SSL para conexiones</span>
                        </label>
                    </div>
                    
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="requireStrongPasswords">
                            <span>Requerir contraseñas fuertes</span>
                        </label>
                    </div>
                    
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="enable2FA">
                            <span>Habilitar autenticación de dos factores</span>
                        </label>
                    </div>
                    
                    <div class="security-actions">
                        <button class="btn btn-primary" onclick="saveSecuritySettings()">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                        <button class="btn btn-secondary" onclick="backupSecurityConfig()">
                            <i class="fas fa-download"></i> Backup
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="settings-actions">
            <button class="btn btn-primary" onclick="saveAllSettings()">
                <i class="fas fa-save"></i> Guardar Todas las Configuraciones
            </button>
            <button class="btn btn-secondary" onclick="resetSettings()">
                <i class="fas fa-undo"></i> Restablecer
            </button>
        </div>
    </div>
</div>

<style>
.settings-tabs {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
}

.tab-buttons {
    display: flex;
    background: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid var(--border-color);
}

.tab-button {
    padding: 15px 20px;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    border-bottom: 2px solid transparent;
}

.tab-button:hover {
    color: var(--accent-blue);
    background: rgba(0, 174, 255, 0.1);
}

.tab-button.active {
    color: var(--accent-blue);
    border-bottom-color: var(--accent-blue);
    background: rgba(0, 174, 255, 0.1);
}

.tab-content {
    padding: 20px;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

.database-list {
    margin: 20px 0;
}

.database-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    margin-bottom: 10px;
}

.db-info {
    flex: 1;
}

.db-info strong {
    display: block;
    margin-bottom: 5px;
    color: var(--accent-blue);
}

.db-info p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

.db-input {
    width: 150px;
    padding: 8px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    border-radius: 3px;
}

.test-connection {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.service-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    margin-bottom: 10px;
}

.service-info h4 {
    color: var(--accent-blue);
    margin-bottom: 5px;
}

.service-config {
    display: flex;
    align-items: center;
    gap: 10px;
}

.service-config input {
    width: 80px;
    padding: 5px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
}

.checkbox-group {
    margin: 15px 0;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    color: var(--text-secondary);
}

.checkbox-group input[type="checkbox"] {
    width: 18px;
    height: 18px;
}

.security-actions {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    gap: 10px;
}

.settings-actions {
    padding: 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}
</style>

<script>
function openTab(tabName) {
    // Ocultar todas las pestañas
    const tabPanes = document.querySelectorAll('.tab-pane');
    tabPanes.forEach(pane => pane.classList.remove('active'));
    
    // Desactivar todos los botones
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => button.classList.remove('active'));
    
    // Mostrar pestaña seleccionada
    document.getElementById(tabName).classList.add('active');
    
    // Activar botón seleccionado
    event.currentTarget.classList.add('active');
}

function testDatabaseConnection() {
    const resultDiv = document.getElementById('dbTestResult');
    resultDiv.innerHTML = `
        <div style="text-align: center; padding: 20px; margin-top: 10px;">
            <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
            <p>Probando conexión...</p>
        </div>
    `;
    
    // Simular prueba de conexión
    setTimeout(() => {
        const success = Math.random() > 0.3; // 70% de éxito
        
        if (success) {
            resultDiv.innerHTML = `
                <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid var(--success); 
                      border-radius: 5px; padding: 15px; color: var(--success); margin-top: 10px;">
                    <i class="fas fa-check-circle"></i> 
                    <strong>Conexión exitosa</strong>
                    <p style="margin-top: 5px; font-size: 0.9rem;">Se ha establecido conexión con todas las bases de datos.</p>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div style="background: rgba(244, 67, 54, 0.2); border: 1px solid var(--danger); 
                      border-radius: 5px; padding: 15px; color: var(--danger); margin-top: 10px;">
                    <i class="fas fa-times-circle"></i> 
                    <strong>Error de conexión</strong>
                    <p style="margin-top: 5px; font-size: 0.9rem;">No se pudo conectar al servidor MySQL. Verifica la configuración.</p>
                </div>
            `;
        }
    }, 2000);
}

function saveAllSettings() {
    // Recopilar configuración de todas las pestañas
    const settings = {
        database: {
            host: document.getElementById('dbHost').value,
            port: document.getElementById('dbPort').value,
            user: document.getElementById('dbUser').value,
            databases: {
                auth: document.getElementById('dbAuth').value,
                characters: document.getElementById('dbCharacters').value,
                world: document.getElementById('dbWorld').value
            }
        },
        server: {
            name: document.getElementById('serverName').value,
            motd: document.getElementById('serverMotd').value,
            maxPlayers: document.getElementById('maxPlayers').value,
            rates: {
                xp: document.getElementById('xpRate').value,
                money: document.getElementById('moneyRate').value,
                drop: document.getElementById('dropRate').value,
                reputation: document.getElementById('repRate').value
            }
        },
        services: {
            soap: {
                port: document.getElementById('soapPort').value
            },
            ra: {
                port: document.getElementById('raPort').value
            },
            world: {
                port: document.getElementById('worldPort').value
            },
            auth: {
                port: document.getElementById('authPort').value
            }
        },
        security: {
            allowedIPs: document.getElementById('allowedIPs').value,
            maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
            lockoutTime: document.getElementById('lockoutTime').value,
            enableSSL: document.getElementById('enableSSL').checked,
            requireStrongPasswords: document.getElementById('requireStrongPasswords').checked,
            enable2FA: document.getElementById('enable2FA').checked
        }
    };
    
    // Aquí iría el código para guardar en Android o servidor
    console.log('Configuración guardada:', settings);
    
    if (typeof Android !== 'undefined' && Android.showToast) {
        Android.showToast('Configuración guardada exitosamente');
    } else {
        alert('Configuración guardada exitosamente');
    }
}

function saveSecuritySettings() {
    alert('Configuración de seguridad guardada');
}

function backupSecurityConfig() {
    alert('Backup de configuración de seguridad creado');
}

function resetSettings() {
    if (confirm('¿Estás seguro de restablecer todas las configuraciones a los valores por defecto?')) {
        // Restablecer valores por defecto
        document.getElementById('dbHost').value = 'localhost';
        document.getElementById('dbPort').value = '3306';
        document.getElementById('dbUser').value = 'root';
        document.getElementById('dbAuth').value = 'auth';
        document.getElementById('dbCharacters').value = 'characters';
        document.getElementById('dbWorld').value = 'world';
        
        if (typeof Android !== 'undefined' && Android.showToast) {
            Android.showToast('Configuración restablecida');
        } else {
            alert('Configuración restablecida');
        }
    }
}

// Inicializar
document.addEventListener('DOMContentLoaded', function() {
    // Cargar configuración guardada si existe
    if (typeof Android !== 'undefined' && Android.getServerConfig) {
        try {
            const config = JSON.parse(Android.getServerConfig());
            if (config) {
                document.getElementById('dbHost').value = config.ip || 'localhost';
                document.getElementById('dbAuth').value = config.auth_db || 'auth';
                document.getElementById('dbCharacters').value = config.chars_db || 'characters';
                document.getElementById('dbWorld').value = config.world_db || 'world';
                document.getElementById('soapPort').value = config.soap_port || '7878';
                document.getElementById('raPort').value = config.ra_port || '3443';
            }
        } catch (error) {
            console.error('Error loading saved config:', error);
        }
    }
});
</script>